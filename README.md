# STM32 Button SPI Counter

**Choose your language / Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ ÑÐ·Ñ‹Ðº :**

*   [English](README.md)
*   [Ð ÑƒÑÑÐºÐ¸Ð¹](README.ru.md)

[![License: MIT](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![STM32CubeIDE](https://img.shields.io/badge/IDE-STM32CubeIDE-%230052b1.svg?logo=stmicroelectronics)](https://www.st.com/en/development-tools/stm32cubeide.html)
[![STM32F4](https://img.shields.io/badge/MCU-STM32F4-%23032671.svg?logo=stmicroelectronics)](https://www.st.com/en/microcontrollers-microprocessors/stm32f4-series.html)

A project for the STM32 microcontroller that implements a button press counter, displaying the value on a three-digit seven-segment display using SPI and dynamic indication.

![Button Press Counter](Docs/btn_counter.jpg)

[Demo Video](Docs/btn_counter.mp4)

## ðŸ“‹ Table of Contents

- [About the Project](#about-the-project)
- [Used Peripherals and Technologies](#used-peripherals-and-technologies)
- [Connection Diagram](#connection-diagram)
- [Build and Run](#build-and-run)
- [Project Structure](#project-structure)
- [Author](#author)
- [License](#license)

## ðŸš€ About the Project

This project demonstrates the use of:
*   **External interrupts (EXTI)** for handling button presses.
*   **The SPI interface** for controlling a 74HC595 shift registe.
*   **Dynamic multiplexing** for displaying a number on a three-digit display.
*   **The HAL driver** from STMicroelectronics.

On each button press, the counter value increments (from 0 to 999, then it resets). The current value is displayed on the indicator.

## ðŸ›  Used Peripherals and Technologies

*   **Microcontroller:** STM32F401CCU6 (but it can also work on other series) as part of the constructor kit [MCUINSIDE v 1.0] (https://electronics-krd.ru/magazin/product/stmf401)
*   **MCU Peripherals (on the kit's board, but can be connected on a breadboard):**
    *   GPIO (Button, LED, controlling display digits)
    *   EXTI (External interrupt from the button)
    *   SPI (Data transmission to the display)
*   **External Components (on the kit's board, but can be connected on a breadboard):**
    *   Button
    *   LED (for press indication)
    *   Three-digit seven-segment display and a shift register.
*   **Development Environment:** STM32CubeIDE
*   **Framework:** STM32CubeF4 HAL
*   **Language:** C

## ðŸ”Œ Connection Diagram

| Component | STM32 Pin |74HC595 Pin | FJ3361H Pin |
| :--- | :--- | :--- | :--- |
| Button | PA3 (EXTI3) | - | - |
| LED (LED) | PA5 | - | - |
| SPI3_SCK | PB3 | SHCP | - |
| SPI3_MOSI | PB5 | DS | - |
| Chip Select (SC) | PB4 | STCP | - |
| Units Digit | PB10 | - | 3 |
| Tens Digit | PB2 | - | 2 |
| Hundreds Digit | PB1 | - | 1 |
| | | Q0 | A |
| | | Q1 | B |
| | | Q2 | C |
| | | Q3 | D |
| | | Q4 | E |
| | | Q5 | F |
| | | Q6 | G |
| | | Q7 | P |

## ðŸ›  Build and Run

1.  **Cloning the repository**
    ```bash
    git clone https://github.com/FSHE-IIoT/stm32-button-spi-7seg.git
    cd stm32-button-spi-7seg
    ```

2.  **Opening the Project**
    *   Launch STM32CubeIDE.
    *   Select `File -> Import -> General -> Existing Projects into Workspace`.
    *   Specify the path to the project folder. The project should appear in the list.

3.  **Building the ProjectÐ°**
    *   In the IDE, open the file button_counter.ioc.
    *   In the toolbar, click on the `Device Configuration Tool Code Generation`.
    *   Click on the hammer icon (`Build` or `Ctrl+B`).

4.  **Flashing the Microcontroller (MCU)**
    *   Connect the debug adapter (e.g., ST-Link) to your computer and to the MCU.
    *   Click on the "bug" icon (`Debug` or `F11`). The IDE will automatically build the project (if necessary) and flash it.

5.  **Running the Program**
    *   After flashing, the program will start running. Press the button and observe the number change on the display.

## ðŸ“ Project Structure
    
    stm32-button-spi-7seg/
    â”‚
    â”œâ”€â”€ Core/
    â”‚   â”œâ”€â”€ Inc/
    â”‚   â”‚   â”œâ”€â”€ main.h              // Main header file generated by CubeMX
    â”‚   â”‚   â”œâ”€â”€ stm32f4xx_hal_conf.h // HAL configuration
    â”‚   â”‚   â””â”€â”€ btn_counter.h       // Custom header: API for button, counter and display handling
    â”‚   â”‚
    â”‚   â””â”€â”€ Src/
    â”‚       â”œâ”€â”€ main.c              // Main file: initialization, main loop, interrupt handling
    â”‚       â”œâ”€â”€ stm32f4xx_it.c      // Interrupt handlers file (contains EXTI3_IRQHandler)
    â”‚       â”œâ”€â”€ stm32f4xx_hal_msp.c // HAL peripheral initialization
    â”‚       â””â”€â”€ btn_counter.c       // Implementation of all counter logic, display and SPI transmission
    â”‚
    â”œâ”€â”€ Drivers/                    // STM32CubeF4 libraries (added automatically by the environment)
    â”œâ”€â”€ STM32F401CCUx_FLASH.ld     // Linker script
    â””â”€â”€ button_counter.ioc         // CubeMX configuration file
    
### Key Modules and Their Interaction:

1.  **`main.c:`**

    *   Initializes the HAL, system clock, and peripherals (via `MX_*_Init()` functions).
    *   Initializes custom modules by calling functions from  `btn_counter.c`.
    *   In the infinite loop (`while (1)`) continuously updates the display by fetching the current counter value.

2.  **`btn_counter.h` / `btn_counter.c`:**

    *   **The heart of the project.** Contains all the user logic.
    *   `Display_InitTypeDef`: Structure for configuring the display digit control pins.
    *   `led_init()`, `btn_init()`, `transmit_init()`, `display_init()`: Initialization functions.
    *   `get_counter()`: Function to get the current counter value.
    *   `update_display()`: Function for dynamic indication (multiplexing).
    *   `HAL_GPIO_EXTI_Callback()`: **Button interrupt handler**. Increments the counter and toggles the LED.

3.  **`stm32fxx_it.c:`(automatically generated when the project is compiled)**

    *   Contains the interrupt vector table. The button interrupt (PA3 -> EXTI3) is handled here in the `EXTI3_IRQHandler()` function, which in turn calls the HAL mechanism and ultimately leads to the execution of  `HAL_GPIO_EXTI_Callback()` in `btn_counter.c`.

4.  **`button_counter.ioc`:**

    *   Visual configuration of pins and peripherals in STM32CubeMX. The following settings are configured here:
        *   SPI3 in Master mode.
        *   Pins PA5 (LED) and PB4 (Chip Select) as GPIO Output.
        *   Pin PA3 (Button) as GPIO External Interrupt.
        *   Pins PB1, PB2, PB10 (Display digits) as GPIO Output.

## ðŸ‘¨ðŸ’» Author

**Oleg Dobrovolsky**
FSHE IIoT - Full Stack Hardware Engineer, Industrial Internet of Things

## ðŸ“„ License

This project is distributed under the MIT License. For more information, see [LICENSE](https://opensource.org/licenses/MIT)
